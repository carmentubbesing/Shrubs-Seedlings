---
title: "Combine_shrub_data"
author: "Carmen"
date: "January 3, 2020"
output: html_document
---

```{r, include=FALSE}
require(tidyverse)
```

# Load data

## Data from others
```{r}
load("~/Shrubs-Seedlings/compiled_data/shrub_growth/Latimer_df.Rdata")
latimer <- df
remove(df)
load("~/Shrubs-Seedlings/compiled_data/shrub_growth/Young_df.Rdata")
young <- df
remove(df)
load("~/Shrubs-Seedlings/compiled_data/shrub_growth/Welch_df.Rdata")
welch <- df
remove(df)
```

## Data from my fire footprints
```{r}
load("~/Shrubs-Seedlings/compiled_data/shrub_growth/My_FireFootprint_data.Rdata")
me <- ht_by_spp
```

# Sync column names
```{r}
latimer <- latimer %>% 
  mutate(Year_meas = 2018) %>% 
  rename(Year.of.Fire = fire_year, Date = SurveyDate) %>% 
  dplyr::select(Fire, years_since_fire, Year_meas, Year.of.Fire, Shrub_species, ShrubHt)
```

```{r}
young <- young %>% 
  rename(Shrub_species = dominant_shrub_1) %>% 
  rename(ShrubHt = dominant_shrub_ht_cm) %>% 
  dplyr::select(-Date)
```

```{r}
me <- me %>% 
  rename(Shrub_species = ShrubSpp) %>% 
  rename(modal_ht_cm = ht_wm.cm.spp) %>% 
  mutate(Year_meas = 2016) %>% 
  mutate(years_since_fire = ifelse(Fire == "AMRC", 8, 0)) %>% 
  mutate(years_since_fire = ifelse(Fire == "CLVD", 24, years_since_fire)) %>% 
  mutate(years_since_fire = ifelse(Fire == "FRDS", 12, years_since_fire)) %>% 
  mutate(years_since_fire = ifelse(Fire == "PLKN", 43, years_since_fire)) %>% 
  mutate(years_since_fire = ifelse(Fire == "STAR", 14, years_since_fire)) %>% 
  mutate(years_since_fire = ifelse(Fire == "WRTS", 35, years_since_fire))
str(me)
```

# Add column for df_source
```{r}
young$df_source = "young"
latimer$df_source = "latimer"
welch$df_source = "welch"
me$df_source = "me"
```

# Remove rows in young that are already in welch
```{r}
young <- anti_join(young, welch, by = c("Year_meas", "Regen_Plot"))
```


# Join
```{r}
df <- full_join(young, latimer)
```

```{r}
df <- df %>% 
  rename(modal_ht_cm = ShrubHt)
```


```{r}
df <- full_join(df, welch)
```

## Check
```{r}
nrow(latimer) + nrow(welch) + nrow(young) == nrow(df)
```

```{r}
summary(as.factor(df$df_source))
```

# Sync shrub species names
```{r}
df <- df %>% 
  mutate(Shrub_species = 
           case_when(Shrub_species == "ARCPAT" ~ "ARPA6",
                     Shrub_species == "ARCVIS" ~ "ARVI",
                     Shrub_species == "CEACOR" ~ "CECO",
                     Shrub_species == "CEAPRO" ~ "CEPR",
                     Shrub_species == "CEAINT" ~ "CEIN3",
                     Shrub_species == "CEINT" ~ "CEIN3",
                     Shrub_species == "CHAFOL" ~ "CHFO",
                     Shrub_species == "CHRSEM" ~ "CHSE11",
                     Shrub_species == "QUEVAC" ~ "QUVA",
                     Shrub_species == "SYMMOL" ~ "SYMO",
                     Shrub_species == "RIBCER" ~ "RIBES",
                     Shrub_species == "RIRO" ~ "RIBES",
                     TRUE ~ Shrub_species))
```

```{r}
summary(as.factor(df$Shrub_species))
```

# Check for same plot, same year
```{r}
summary(as.factor(latimer$years_since_fire))
summary(as.factor(young$years_since_fire))
```

```{r}
summary(as.factor(latimer$Fire))
summary(as.factor(young$Fire))
```

```{r}
young %>% 
  filter(years_since_fire %in% latimer$years_since_fire & Fire %in% c("AMERICAN RIVER", "MOONLIGHT", "POWER"))
```

All good!

# Plot for all species together
```{r}
ggplot(df, aes(x = years_since_fire, y = modal_ht_cm))+
  geom_point()+
  geom_smooth(method = "loess", span = 1)
```

# Sooo I should take out the oldest fire, Cottonwood, which Derek mentioned is at the sagebrush ecotone so not a good comparison
```{r}
df <- df %>% 
  filter(years_since_fire<24)
```

# Plot for all species together again
```{r}
ggplot(df, aes(x = years_since_fire, y = modal_ht_cm))+
  geom_point()+
  geom_smooth(method = "loess", span = 1)
```

# Add data from fire footprints
```{r}
me <- me %>% 
  dplyr::select(Fire, years_since_fire, Year_meas, Shrub_species, modal_ht_cm, df_source)
df <- full_join(df, me)
```

## Check
```{r}
nrow(latimer) + nrow(welch) + nrow(young) + nrow(me) == nrow(df)
```

# Sync species names
```{r}
summary(as.factor(df$Shrub_species))

df <- df %>% 
  mutate(Shrub_species = 
           case_when(Shrub_species == "ARPA" ~ "ARPA6",
                     Shrub_species == "CEIN" ~ "CEIN3",
                     Shrub_species == "CHSE" ~ "CHSE11",
                     TRUE ~ Shrub_species))
```


# Plot for all species together again
```{r}
ggplot(df, aes(x = years_since_fire, y = modal_ht_cm))+
  geom_point()+
  geom_smooth(method = "loess", span = 1)
```


# Plot just for ARVI and ARPA
```{r}
ggplot(df %>% filter(Shrub_species %in% c("ARVI", "ARPA6")), aes(x = years_since_fire, y = modal_ht_cm, col = Shrub_species))+
  geom_point()+
    geom_smooth(method = "loess")
```

# Lump ARVI and ARPA
```{r}
df <- df %>% 
  mutate(Shrub_species = 
           case_when(Shrub_species == "ARPA6" ~ "ARPA6_ARVI",
                     Shrub_species == "ARVI" ~ "ARPA6_ARVI",
                     TRUE ~ Shrub_species))
```

# Plot for manzanita, whitethorn, and deerbrush
```{r}
ggplot(df %>% 
         filter(Shrub_species %in% c("ARPA6_ARVI", "CEIN3", "CECO")),
       aes(x = years_since_fire, y = modal_ht_cm, col = Shrub_species))+
  geom_point(aes(shape = df_source))+
  geom_smooth(method = "loess", span = 1)+
  theme_bw()
```


# Plot for manzanita, whitethorn, and deerbrush
```{r}
ggplot(df %>% 
         filter(Shrub_species %in% c("ARPA6_ARVI", "CEIN3", "CECO")),
       aes(x = years_since_fire, y = modal_ht_cm, col = Shrub_species))+
  geom_point(aes(shape = df_source))+
  geom_smooth(method = "loess", span = 1)+
  theme_bw()
```

# Plot for all species that are in my data and have at least 5 years of data
```{r}
under6years <- df %>% 
  select(Shrub_species, years_since_fire) %>% 
  distinct() %>% 
  group_by(Shrub_species) %>% 
  summarize(count = n()) %>% 
  filter(count >4) %>% 
  filter(Shrub_species != "none")
under6years
```

```{r}
focal_spp <- df %>% 
  filter(df_source == "me") %>% 
  dplyr::select(Shrub_species) %>% 
  distinct()
focal_spp
```

```{r}
ggplot(df %>% filter(Shrub_species %in% under5years$Shrub_species & Shrub_species %in% focal_spp$Shrub_species),
       aes(x = years_since_fire, y = modal_ht_cm, col = Shrub_species))+
  geom_point(aes(shape = df_source))+
  geom_smooth(method = "loess", span = 1)+
  theme_bw()
```


