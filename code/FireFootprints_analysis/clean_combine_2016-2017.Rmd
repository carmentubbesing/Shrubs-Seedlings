---
title: "Fire Footprints Data Compile - 2016 and 2017"
author: "Carmen"
date: "September 20, 2017"
output: 
    html_document:
        toc: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=F}
require(readxl)
require(dplyr)
require(tidyr)
require(ggplot2)
```

# Read in 2017 data
```{r}
setwd("~/../Dropbox (Stephens Lab)/SORTIE/FireFootprints_2017/data/compiled/")
df17 <- read_excel("Shrubs_Summer17_Compiled_Sep14.xlsx")
```

# Read in 2016 data
```{r}
setwd("~/Shrubs-Seedlings/compiled_data/")
df16 <- read.csv("master_data_2016.csv")
```

# Combine
```{r}
df <- full_join(df16, df17, by = "Sdlg")
```

# Take out the incense cedar
```{r}
df <- df %>% 
  filter(Species.x != "CADE")
```

# Sync up repeat column names

## Check for different species
```{r}
df %>% 
  filter(Species.x != Species.y)
```

## Go with 2017 species when it's listed since one tree's species was corrected
```{r}
df <- df %>% 
  mutate(Species = ifelse(!is.na(Species.y), Species.y, Species.x)) %>% 
  select(-Species.x, -Species.y)
```


## Correct species names
```{r}
summary(as.factor(df$Species))
df %>% 
  filter(Species == 2)
df <- df %>% 
  mutate(Species = ifelse(Sdlg %in% c(20:23), "PIPO", Species))
```

## Sync fire and fire patch
```{r}
df %>% 
  filter(FirePatch.x != FirePatch.y)
df <- df %>% 
  rename(FirePatch = FirePatch.x) %>% 
  select(-FirePatch.y)
df <- df %>% 
  rename(Fire = Fire.x) %>% 
  select(-Fire.y)
```

## Rename date and datasheet columns
```{r}
df <- df %>% 
  rename(Date = Date.x) %>% 
  select(-Date.y) %>% 
  rename(DataSheet2017 = DataSheet)
```

## Rename basal diameter and height columns
```{r}
df <- df %>% 
  rename( BasDia2016.cm = BasDia.cm) %>% 
  rename(BasDia2017.mm.1 = Dia_1_mm) %>% 
  rename(BasDia2017.mm.2 = Dia_2_mm ) %>% 
  rename(Ht2016.cm = Ht.cm) %>% 
  rename(Ht2017.cm = Ht_cm)
```

## Reorder columns
```{r}
df <- df %>% 
  select(Sdlg, Species, Fire, FirePatch, Ht2016.cm, Ht2017.cm, everything())
```

# Find missing seedlings from 2017 data
```{r}
df %>% 
  filter(is.na(Ht2017.cm) & is.na(Status)) %>% 
  select(Sdlg, Status, FirePatch, DataSheet2017, notes)
```

## Record why things were left out 
```{r}
df <- df %>% 
  mutate(Status = ifelse(Sdlg %in% c(19,28, 139, 137), "exclude, lone in patch", Status)) %>% 
  mutate(Status = ifelse(FirePatch == "FRDS-JB" | Sdlg %in% c(58,80,91,92,93,100,103,106,107,229,176), "not found",Status)) %>% 
  mutate(Status = ifelse(Sdlg == 7, "exclude, under oak", Status))

```

## Remove seedlings that were excluded for reasons other than dead or couldn't find them
```{r}
df <- df %>% 
  filter(!Status %in% c("exclude, under oak", "exclude, lone in patch"))
summary(as.factor(df$Status))
```


# Create shrubarea variables for each distance from the seedling
```{r}
df <- df %>% 
  mutate(shrubarea1 = Ht1 * Cov1) %>% 
  mutate(shrubarea2 = Ht1.2 * Cov1.2) %>% 
  mutate(shrubarea3 = Ht1.3 * Cov1.3)
```

### Fix NA shrubarea
```{r}
df <- df %>% filter(!(is.na(shrubarea2) & Sdlg == "17"))
```

# Save
```{r}
save(df, file = "~/../Documents/Shrubs-Seedlings/compiled_data/fire_footprints/master_seedlings1.Rdata")
write.csv(df, file = "~/../Documents/Shrubs-Seedlings/compiled_data/fire_footprints/master_seedlings1.csv", row.names = F)
```

