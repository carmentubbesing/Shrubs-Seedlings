---
title: "Fire Footprints Data Compile - 2016 and 2017"
author: "Carmen"
date: "September 20, 2017"
output: 
    html_document:
        toc: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=F}
require(readxl)
require(dplyr)
require(tidyr)
require(ggplot2)
```

# Read in 2017 data
```{r}
setwd("~/../Dropbox (Stephens Lab)/SORTIE/FireFootprints_2017/data/compiled/")
df17 <- read_excel("Shrubs_Summer17_Compiled_Sep14.xlsx")
```

# Read in 2016 data
```{r}
setwd("~/Shrubs-Seedlings/compiled_data/fire_footprints/")
load("master_data_2016.Rdata")
df16 <- df
remove(df)
```

# Combine
```{r}
df <- full_join(df16, df17, by = "Sdlg")
```

# Take out the incense cedar
```{r}
df <- df %>% 
  filter(Species.x != "CADE")
```

# Sync up repeat column names

## Check for different species
```{r}
df %>% 
  filter(Species.x != Species.y)
```

## Go with 2017 species when it's listed since one tree's species was corrected
```{r}
df <- df %>% 
  mutate(Species = ifelse(!is.na(Species.y), Species.y, Species.x)) %>% 
  select(-Species.x, -Species.y)
```


## Correct species names
```{r}
summary(as.factor(df$Species))
df %>% 
  filter(Species == 2)
df <- df %>% 
  mutate(Species = ifelse(Sdlg %in% c(20:23), "PIPO", Species))
```

## Sync fire and fire patch
```{r}
df %>% 
  filter(FirePatch.x != FirePatch.y)
df <- df %>% 
  rename(FirePatch = FirePatch.x) %>% 
  select(-FirePatch.y)
df <- df %>% 
  rename(Fire = Fire.x) %>% 
  select(-Fire.y)
```

## Rename date and datasheet columns
```{r}
df <- df %>% 
  rename(Date = Date.x) %>% 
  select(-Date.y) %>% 
  rename(DataSheet2017 = DataSheet)
```

## Rename basal diameter and height columns
```{r}
df <- df %>% 
  rename( BasDia2016.cm = BasDia.cm) %>% 
  rename(BasDia2017.mm.1 = Dia_1_mm) %>% 
  rename(BasDia2017.mm.2 = Dia_2_mm ) %>% 
  rename(Ht2016.cm = Ht.cm) %>% 
  rename(Ht2017.cm = Ht_cm)
```

## Reorder columns
```{r}
df <- df %>% 
  select(Sdlg, Species, Fire, FirePatch, Ht2016.cm, Ht2017.cm, everything())
```

# Find missing seedlings from 2017 data
```{r}
df %>% 
  filter(is.na(Ht2017.cm) & is.na(Status)) %>% 
  select(Sdlg, Status, FirePatch, DataSheet2017, notes)
```

## Record why things were left out 
```{r}
df <- df %>% 
  mutate(Status = ifelse(Sdlg %in% c(19,28, 139, 137), "exclude, lone in patch", Status)) %>% 
  mutate(Status = ifelse(FirePatch == "FRDS-JB" | Sdlg %in% c(58,80,91,92,93,100,103,106,107,229,176), "not found",Status)) %>% 
  mutate(Status = ifelse(Sdlg == 7, "exclude, under oak", Status))

```

## Remove seedlings that were excluded for reasons other than dead or couldn't find them
```{r}
df <- df %>% 
  filter(!Status %in% c("exclude, under oak", "exclude, lone in patch"))
summary(as.factor(df$Status))
```


# Create shrubarea variables for each distance from the seedling
```{r}
df <- df %>% 
  mutate(shrubarea1 = Ht1 * Cov1) %>% 
  mutate(shrubarea2 = Ht1.2 * Cov1.2) %>% 
  mutate(shrubarea3 = Ht1.3 * Cov1.3)
```

### Fix NA shrubarea
```{r}
df <- df %>% filter(!(is.na(shrubarea2) & Sdlg == "17"))
```

# Add soil data
```{r}
df <- df %>% 
  mutate(soil_type_dom = ifelse(FirePatch == "AMCR-NW", "McCarthy", 0)) %>% 
  mutate(soil_type_dom = ifelse(FirePatch == "AMCR-3", "Hurlbut", soil_type_dom)) %>% 
  mutate(soil_type_dom = ifelse(FirePatch == "AMCR-NE", "Smokey", soil_type_dom)) %>% 
  mutate(soil_type_dom = ifelse(FirePatch == "STAR-NW", "McCarthy", soil_type_dom)) %>% 
  mutate(soil_type_dom = ifelse(FirePatch == "STAR-S", "Ahart", soil_type_dom)) %>% 
  mutate(soil_type_dom = ifelse(FirePatch == "CLVD-N", "Jocal", soil_type_dom)) %>% 
  mutate(soil_type_dom = ifelse(FirePatch == "CLVD-SE", "Holland", soil_type_dom)) 
  
df <- df %>% 
  mutate(soil_series = ifelse(FirePatch == "AMCR-NW", "SMG", 0)) %>% 
  mutate(soil_series = ifelse(FirePatch == "AMCR-3", "HUG", soil_series)) %>% 
  mutate(soil_series = ifelse(FirePatch == "AMCR-NE", "SMG", soil_series)) %>% 
  mutate(soil_series = ifelse(FirePatch == "STAR-NW", "MCG", soil_series)) %>% 
  mutate(soil_series = ifelse(FirePatch == "STAR-S", "ACF", soil_series)) %>% 
  mutate(soil_series = ifelse(FirePatch == "CLVD-N", "153", soil_series)) %>% 
  mutate(soil_series = ifelse(FirePatch == "CLVD-SE", "149", soil_series)) %>% 
  mutate(soil_series = ifelse(Sdlg %in% c(123, 124, 122), "128", soil_series)) %>% 
  mutate(soil_series = ifelse(!(Sdlg %in% c(123, 124, 122)) & FirePatch == "WRTS-1", "222", soil_series)) %>% 
  mutate(soil_series = ifelse(Sdlg %in% c(177, 178), "PVG", soil_series)) %>% 
  mutate(soil_series = ifelse(Sdlg %in% c(175, 176), "PTE", soil_series)) %>% 
  mutate(soil_series = ifelse(Sdlg %in% c(202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 215, 216:219, 214, 221, 220, 222:225), "HUG", soil_series)) %>% 
  mutate(soil_series = ifelse(Sdlg %in% c(103, 100, 101, 102, 98, 99, 97, 226), "MCE", soil_series)) %>% 
  mutate(soil_series = ifelse(Sdlg %in% c(82:84, 104:107, 88, 85:97, 81, 90, 91:93, 94, 78, 79, 105, 80, 76, 95, 96, 73:75, 77, 76), "MCE", soil_series)) %>% 
  mutate(soil_series = ifelse(Sdlg %in% c(20:25), "149", soil_series)) %>% 
  mutate(soil_series = ifelse(Sdlg %in% c(131:132, 130, 129, 125), "149", soil_series)) %>% 
  mutate(soil_series = ifelse(Sdlg %in% c(128, 127, 133:134), "193", soil_series)) %>% 
  mutate(soil_series = ifelse(FirePatch == "FRDS-mid" | Sdlg %in% c(26, 27), "108", soil_series)) %>% 
  mutate(soil_series = ifelse(FirePatch == "FRDS-SE", "108", soil_series))
  

  
summary(as.factor(df$soil_type_dom))
df %>% 
  group_by(FirePatch, soil_series) %>% 
  summarize(n())
df %>% 
  filter(Fire == "FRDS" & soil_series == 0) %>% 
  select(Sdlg)

```

## Add soil orders and soborders

sources: 
-  NRCS. 2019. Web Soil Survey, USDA Natural Resources Conservation Service. http://websoilsurvey.sc.egov.usda.gov/App/WebSoilSurvey.aspx.
-  https://soilseries.sc.egov.usda.gov/osdname.aspx
-  https://www.nrcs.usda.gov/Internet/FSE_DOCUMENTS/nrcs142p2_051232.pdf

```{r}
df <- df %>% 
  mutate(soil_order = ifelse(soil_series == "HUG", "Inceptisol", 0)) %>% 
  mutate(soil_suborder = ifelse(soil_series == "HUG", "Xerept", 0)) %>% 
  
  mutate(soil_order = ifelse(soil_series %in% c("MCE", "MCG"), "Andisol", soil_order)) %>% 
  mutate(soil_suborder = ifelse(soil_series %in% c("MCE", "MCG"), "Xerand", soil_suborder)) %>% 
  
  mutate(soil_order = ifelse(soil_series == "HUG", "Inceptisol", soil_order)) %>% 
  mutate(soil_suborder = ifelse(soil_series == "HUG", "Xerept", soil_suborder)) %>% 
  
  mutate(soil_order = ifelse(soil_series == "153", "Ultisol", soil_order)) %>% 
  mutate(soil_suborder = ifelse(soil_series == "153", "Xerult", soil_suborder)) %>% 
  
  mutate(soil_order = ifelse(soil_series == "149", "Alfisol", soil_order)) %>% 
  mutate(soil_suborder = ifelse(soil_series == "149", "Xeralf", soil_suborder)) %>% 
  
  mutate(soil_order = ifelse(soil_series == "108", "Inceptisol", soil_order)) %>% 
  mutate(soil_suborder = ifelse(soil_series == "108", "Xerept", soil_suborder)) %>% 
  
  mutate(soil_order = ifelse(soil_series == "SMG", "Inceptisol", soil_order)) %>% 
  mutate(soil_suborder = ifelse(soil_series == "SMG", "Xerept", soil_suborder)) %>% 
  
  mutate(soil_order = ifelse(soil_series == "222", "Inceptisol", soil_order)) %>% 
  mutate(soil_suborder = ifelse(soil_series == "222", "Xerept", soil_suborder)) %>% 
  
  mutate(soil_order = ifelse(soil_series == "128", "Inceptisol", soil_order)) %>% 
  mutate(soil_suborder = ifelse(soil_series == "128", "Xerept", soil_suborder)) %>% 
  
  mutate(soil_order = ifelse(soil_series == "193", "Inceptisol", soil_order)) %>% 
  mutate(soil_suborder = ifelse(soil_series == "193", "Xerept", soil_suborder)) %>% 
  
  mutate(soil_order = ifelse(soil_series == "PTE", "Inceptisol", soil_order)) %>% 
  mutate(soil_suborder = ifelse(soil_series == "PTE", "Xerept", soil_suborder)) %>% 
  
  mutate(soil_order = ifelse(soil_series == "ACF", "Andisol", soil_order)) %>% 
  mutate(soil_suborder = ifelse(soil_series == "ACF", "Xerand", soil_suborder))
  
df %>% 
  group_by(soil_order, soil_suborder) %>% 
  arrange(soil_order) %>% 
  summarize(n())
```


# Save
```{r}
save(df, file = "~/../Documents/Shrubs-Seedlings/compiled_data/fire_footprints/master_seedlings1.Rdata")
write.csv(df, file = "~/../Documents/Shrubs-Seedlings/compiled_data/fire_footprints/master_seedlings1.csv", row.names = F)
```

